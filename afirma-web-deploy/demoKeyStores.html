<!--
 Este fichero forma parte del Cliente @firma. 
 El Cliente @firma es un applet de libre distribución cuyo código fuente puede ser consultado
 y descargado desde www.ctt.map.es.
 Copyright 2009,2010 Ministerio de la Presidencia, Gobierno de España (opcional: correo de contacto)
 Este fichero se distribuye bajo las licencias EUPL versión 1.1  y GPL versión 3  según las
 condiciones que figuran en el fichero 'licence' que se acompaña.  Si se   distribuyera este 
 fichero individualmente, deben incluirse aquí las condiciones expresadas allí.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <!-- Ejemplo básico de lanzador de la aplicación -->
	<head>
		<title>Demo KeyStores</title>
		<link rel="stylesheet" href="style.css" type="text/css">
		<script type="text/javascript" src="common-js/deployJava.js"></script>
		<script type="text/javascript" src="common-js/instalador.js"></script>
		<script type="text/javascript" src="constantes.js"></script>
		<script language="javascript">
        	
			function establecerKeyStore() {

				var path = document.getElementById('ksPath').value;
				var pass = document.getElementById('ksPass').value;
				var ks = document.getElementById('keystores').value;

				clienteFirma.setKeyStore(path, pass, ks);

				/* Si conociesemos el alias del certificado, podriamos indicarlo directamente tal como sigue para firmar
				   sin que el usuario indicase absolutamente nada. */

				/* clienteFirma.setSelectedCertificateAlias("alias"); */
			}

			function mostrarResultado() {

				if(clienteFirma.isError()) {
					document.getElementById('firma').value = clienteFirma.getErrorMessage();
				} else {
					document.getElementById('firma').value = clienteFirma.getSignatureBase64Encoded();
				}
			}

			function realizarOperacion() {

				clienteFirma.initialize();

				establecerKeyStore();
				clienteFirma.setFileuri(document.getElementById('ficheroDatos').value);

				if(clienteFirma.isError()) {
					document.getElementById('firma').value = clienteFirma.getErrorMessage();
					return;
				}

				clienteFirma.sign();
				
				mostrarResultado();
			}

		</script>
		<title>Cliente firma - Ejemplo de gesti&oacute;n de almac&eacute;n de claves</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
	</head>
	<body>
		<script type="text/javascript">
			cargarAppletFirma();
		</script>
		<p style="font-weight:bold;font-size:16pt;" align="center">Demostraci&oacute;n de acceso a distintos repositorios</p>
		<form name="prueba" id="prueba">
			<table align="center">
			<tr>
				<td>
					<fieldset><legend>Almac&eacute;n de certificados</legend>
					<table>
						<tr>
							<td>Almac&eacute;n</td>
							<td>Contrase&ntilde;a</td>
						</tr>
						<tr>
							<td id="keystoresCell">
								<input id="ksPath" type="text"/>
							</td>
							<td id="keystoresCell">
								<input id="ksPass" type="text"/>
							</td>
						</tr>
						<tr>
							<td colspan="2">Tipo</td>
						</tr>
						<tr>
							<td colspan="2">
								<select id="keystores">
									<option value="P12" selected="selected">PKCS#12 / PFX</option>
									<option value="JKS">Java KeyStore / JKS</option>
									<option value="JCEKS">Java Cryptography Extension KeyStore (JCEKS)</option>
									<option value="JAVACE">Java Cryptography Extension Case Exact KeyStore (JAVACE)</option>
									<option value="P11">M&oacute;dulo PKCS#11</option>
									<option value="WINDOWS">Almac&eacute;n Microsoft Windows</option>
									<option value="MOZILLA">Almac&eacute;n Mozilla Firefox</option>
									<option value="APPLE">Almac&eacute;n Apple Macintosh</option>
								</select>
							</td>
						</tr>
					</table>
					</fieldset>
				</td>
			</tr>
			<tr>
				<td>
					<fieldset><legend>Firma:</legend>
					<table>
						<tr>
							<td>Fichero de datos:</td>
						</tr>
						<tr>
							<td>
								
								<input type="text" id="ficheroDatos" name="ficheroDatos" width="300"/>
							</td>
						</tr>
						<tr>
							<td>
								<input type="button" onclick="realizarOperacion();return false;" value="Firmar" />
							</td>
						</tr>
						<tr>
							<td>Resultado:</td>
						</tr>
						<tr>
							<td>
								<textarea id="firma" name="firma" cols="80" rows="10"></textarea>
							</td>
						</tr>
					</table>
					</fieldset>
				</td>
			</tr>
		</table>
		</form>
	</body>
</html>	